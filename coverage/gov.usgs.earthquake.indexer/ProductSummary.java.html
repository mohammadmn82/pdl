<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProductSummary.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pdl</a> &gt; <a href="index.source.html" class="el_package">gov.usgs.earthquake.indexer</a> &gt; <span class="el_source">ProductSummary.java</span></div><h1>ProductSummary.java</h1><pre class="source lang-java linenums">/*
 * ProductSummary
 */
package gov.usgs.earthquake.indexer;

import gov.usgs.earthquake.product.Product;
import gov.usgs.earthquake.product.ProductId;
import gov.usgs.util.XmlUtils;

import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.Map;
import java.math.BigDecimal;
import java.net.URL;
import java.util.List;
import java.net.URI;

/**
 * A ProductSummary is essentially a product without its contents.
 *
 * These are usually created by {@link IndexerModule}s, which may
 * inspect Product Content to add additional summary properties.
 */
public class ProductSummary {

	/** An ID used by the ProductIndex. */
<span class="fc" id="L29">	private Long indexId = null;</span>

	/** The product id. */
<span class="fc" id="L32">	private ProductId id = null;</span>

	/** The product status. */
<span class="fc" id="L35">	private String status = null;</span>

	/** The product tracker url. */
<span class="fc" id="L38">	private URL trackerURL = null;</span>

	/** The product properties. */
<span class="fc" id="L41">	private Map&lt;String, String&gt; properties = new HashMap&lt;String, String&gt;();</span>

	/** The product links. */
<span class="fc" id="L44">	private Map&lt;String, List&lt;URI&gt;&gt; links = new HashMap&lt;String, List&lt;URI&gt;&gt;();</span>

	/** Unique identifier for this event. */
<span class="fc" id="L47">	private String eventSource = null;</span>

	/** Unique identifier from the event network. */
<span class="fc" id="L50">	private String eventSourceCode = null;</span>

	/** When the event occurred. */
<span class="fc" id="L53">	private Date eventTime = null;</span>

	/** Where the event occurred. */
<span class="fc" id="L56">	private BigDecimal eventLatitude = null;</span>

	/** Where the event occurred. */
<span class="fc" id="L59">	private BigDecimal eventLongitude = null;</span>

	/** Where the event occurred. */
<span class="fc" id="L62">	private BigDecimal eventDepth = null;</span>

	/** How big the event was. */
<span class="fc" id="L65">	private BigDecimal eventMagnitude = null;</span>

	/** Product version. */
<span class="fc" id="L68">	private String version = null;</span>

	/** Whether this product is &quot;preferred&quot;. */
<span class="fc" id="L71">	private long preferredWeight = 0;</span>

	/**
	 * Empty constructor.
	 */
<span class="fc" id="L76">	public ProductSummary() {</span>
<span class="fc" id="L77">	}</span>

	/**
	 * Copy constructor for ProductSummary.
	 *
	 * Does a deep copy of properties and links maps. All other attributes are
	 * copied by reference.
	 *
	 * @param copy
	 *            product summary to copy.
	 */
<span class="fc" id="L88">	public ProductSummary(final ProductSummary copy) {</span>
<span class="fc" id="L89">		this.indexId = copy.getIndexId();</span>
<span class="fc" id="L90">		this.id = copy.getId();</span>
<span class="fc" id="L91">		this.status = copy.getStatus();</span>
<span class="fc" id="L92">		this.trackerURL = copy.getTrackerURL();</span>
<span class="fc" id="L93">		this.properties.putAll(copy.getProperties());</span>

<span class="fc" id="L95">		Map&lt;String, List&lt;URI&gt;&gt; copyLinks = copy.getLinks();</span>
<span class="fc" id="L96">		Iterator&lt;String&gt; iter = copyLinks.keySet().iterator();</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">		while (iter.hasNext()) {</span>
<span class="fc" id="L98">			String relation = iter.next();</span>
<span class="fc" id="L99">			links.put(relation, new LinkedList&lt;URI&gt;(copyLinks.get(relation)));</span>
<span class="fc" id="L100">		}</span>

<span class="fc" id="L102">		this.setEventSource(copy.getEventSource());</span>
<span class="fc" id="L103">		this.setEventSourceCode(copy.getEventSourceCode());</span>
<span class="fc" id="L104">		this.setEventTime(copy.getEventTime());</span>
<span class="fc" id="L105">		this.setEventLatitude(copy.getEventLatitude());</span>
<span class="fc" id="L106">		this.setEventLongitude(copy.getEventLongitude());</span>
<span class="fc" id="L107">		this.setEventDepth(copy.getEventDepth());</span>
<span class="fc" id="L108">		this.setEventMagnitude(copy.getEventMagnitude());</span>
<span class="fc" id="L109">		this.setVersion(copy.getVersion());</span>
<span class="fc" id="L110">		this.setPreferredWeight(copy.getPreferredWeight());</span>
<span class="fc" id="L111">	}</span>

	/**
	 * Create a ProductSummary from a product.
	 *
	 * All attributes are copied from the product, and preferredWeight is set to
	 * 1L.
	 *
	 * @param product
	 *            the product to summarize.
	 */
<span class="fc" id="L122">	public ProductSummary(final Product product) {</span>
<span class="fc" id="L123">		this.id = product.getId();</span>
<span class="fc" id="L124">		this.status = product.getStatus();</span>
<span class="fc" id="L125">		this.trackerURL = product.getTrackerURL();</span>
<span class="fc" id="L126">		this.properties.putAll(product.getProperties());</span>

<span class="fc" id="L128">		Map&lt;String, List&lt;URI&gt;&gt; copyLinks = product.getLinks();</span>
<span class="fc" id="L129">		Iterator&lt;String&gt; iter = copyLinks.keySet().iterator();</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">		while (iter.hasNext()) {</span>
<span class="fc" id="L131">			String relation = iter.next();</span>
<span class="fc" id="L132">			links.put(relation, new LinkedList&lt;URI&gt;(copyLinks.get(relation)));</span>
<span class="fc" id="L133">		}</span>

<span class="fc" id="L135">		this.setEventSource(product.getEventSource());</span>
<span class="fc" id="L136">		this.setEventSourceCode(product.getEventSourceCode());</span>
<span class="fc" id="L137">		this.setEventTime(product.getEventTime());</span>
<span class="fc" id="L138">		this.setEventLatitude(product.getLatitude());</span>
<span class="fc" id="L139">		this.setEventLongitude(product.getLongitude());</span>
<span class="fc" id="L140">		this.setEventDepth(product.getDepth());</span>
<span class="fc" id="L141">		this.setEventMagnitude(product.getMagnitude());</span>
<span class="fc" id="L142">		this.setVersion(product.getVersion());</span>
<span class="fc" id="L143">		this.setPreferredWeight(1L);</span>
<span class="fc" id="L144">	}</span>

	/** @return indexId */
	public Long getIndexId() {
<span class="fc" id="L148">		return indexId;</span>
	}

	/** @param indexId to set */
	public void setIndexId(Long indexId) {
<span class="fc" id="L153">		this.indexId = indexId;</span>
<span class="fc" id="L154">	}</span>

	/** @return product id */
	public ProductId getId() {
<span class="fc" id="L158">		return id;</span>
	}

	/** @param id to set */
	public void setId(ProductId id) {
<span class="fc" id="L163">		this.id = id;</span>
<span class="fc" id="L164">	}</span>

	/** @return status */
	public String getStatus() {
<span class="fc" id="L168">		return status;</span>
	}

	/** @param status to set */
	public void setStatus(String status) {
<span class="fc" id="L173">		this.status = status;</span>
<span class="fc" id="L174">	}</span>

	/** @return if product is deleted */
	public boolean isDeleted() {
<span class="fc bfc" id="L178" title="All 2 branches covered.">		if (Product.STATUS_DELETE.equalsIgnoreCase(this.status)) {</span>
<span class="fc" id="L179">			return true;</span>
		} else {
<span class="fc" id="L181">			return false;</span>
		}
	}

	/** @return trackerURL */
	public URL getTrackerURL() {
<span class="fc" id="L187">		return trackerURL;</span>
	}

	/** @param trackerURL to set */
	public void setTrackerURL(URL trackerURL) {
<span class="fc" id="L192">		this.trackerURL = trackerURL;</span>
<span class="fc" id="L193">	}</span>

	/** @return preferredWeight */
	public long getPreferredWeight() {
<span class="fc" id="L197">		return preferredWeight;</span>
	}

	/** @param weight to set */
	public void setPreferredWeight(long weight) {
<span class="fc" id="L202">		this.preferredWeight = weight;</span>
<span class="fc" id="L203">	}</span>

	/**
	 * @return the properties
	 */
	public Map&lt;String, String&gt; getProperties() {
<span class="fc" id="L209">		return properties;</span>
	}

	/**
	 * @param properties
	 *            the properties to set
	 */
	public void setProperties(final Map&lt;String, String&gt; properties) {
<span class="fc" id="L217">		this.properties.putAll(properties);</span>
<span class="fc" id="L218">	}</span>

	/**
	 * Returns a reference to the links map.
	 *
	 * @return the links
	 */
	public Map&lt;String, List&lt;URI&gt;&gt; getLinks() {
<span class="fc" id="L226">		return links;</span>
	}

	/**
	 * Copies entries from provided map.
	 *
	 * @param links
	 *            the links to set
	 */
	public void setLinks(final Map&lt;String, List&lt;URI&gt;&gt; links) {
<span class="fc" id="L236">		this.links.clear();</span>
<span class="fc" id="L237">		this.links.putAll(links);</span>
<span class="fc" id="L238">	}</span>

	/**
	 * Add a link to a product.
	 *
	 * @param relation
	 *            how link is related to product.
	 * @param href
	 *            actual link.
	 */
	public void addLink(final String relation, final URI href) {
<span class="fc" id="L249">		List&lt;URI&gt; relationLinks = links.get(relation);</span>
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">		if (relationLinks == null) {</span>
<span class="fc" id="L251">			relationLinks = new LinkedList&lt;URI&gt;();</span>
<span class="fc" id="L252">			links.put(relation, relationLinks);</span>
		}
<span class="fc" id="L254">		relationLinks.add(href);</span>
<span class="fc" id="L255">	}</span>

	/** @return null or eventId */
	public String getEventId() {
<span class="pc bpc" id="L259" title="1 of 4 branches missed.">		if (eventSource == null || eventSourceCode == null) {</span>
<span class="fc" id="L260">			return null;</span>
		}
<span class="fc" id="L262">		return (eventSource + eventSourceCode).toLowerCase();</span>
	}

	/** @return eventSource */
	public String getEventSource() {
<span class="fc" id="L267">		return eventSource;</span>
	}

	/** @param eventSource to set */
	public void setEventSource(String eventSource) {
<span class="fc" id="L272">		this.eventSource = eventSource;</span>

		// event ids are case insensitive, force lower.
<span class="fc bfc" id="L275" title="All 2 branches covered.">		if (this.eventSource != null) {</span>
<span class="fc" id="L276">			this.eventSource = this.eventSource.toLowerCase();</span>
		}

<span class="fc bfc" id="L279" title="All 2 branches covered.">		if (this.eventSource != null) {</span>
<span class="fc" id="L280">			this.properties.put(Product.EVENTSOURCE_PROPERTY, this.eventSource);</span>
		} else {
<span class="fc" id="L282">			this.properties.remove(Product.EVENTSOURCE_PROPERTY);</span>
		}
<span class="fc" id="L284">	}</span>

	/** @return eventSourceCode */
	public String getEventSourceCode() {
<span class="fc" id="L288">		return eventSourceCode;</span>
	}

	/** @param eventSourceCode to set */
	public void setEventSourceCode(String eventSourceCode) {
<span class="fc" id="L293">		this.eventSourceCode = eventSourceCode;</span>

		// event ids are case insensitive, force lower.
<span class="fc bfc" id="L296" title="All 2 branches covered.">		if (this.eventSourceCode != null) {</span>
<span class="fc" id="L297">			this.eventSourceCode = this.eventSourceCode.toLowerCase();</span>
		}

<span class="fc bfc" id="L300" title="All 2 branches covered.">		if (this.eventSourceCode != null) {</span>
<span class="fc" id="L301">			this.properties.put(Product.EVENTSOURCECODE_PROPERTY,</span>
					this.eventSourceCode);
		} else {
<span class="fc" id="L304">			this.properties.remove(Product.EVENTSOURCECODE_PROPERTY);</span>
		}
<span class="fc" id="L306">	}</span>

	/** @return eventTime */
	public Date getEventTime() {
<span class="fc" id="L310">		return eventTime;</span>
	}

	/** @param eventTime to set */
	public void setEventTime(Date eventTime) {
<span class="fc" id="L315">		this.eventTime = eventTime;</span>
<span class="fc bfc" id="L316" title="All 2 branches covered.">		if (eventTime != null) {</span>
<span class="fc" id="L317">			this.properties.put(Product.EVENTTIME_PROPERTY,</span>
<span class="fc" id="L318">					XmlUtils.formatDate(eventTime));</span>
		} else {
<span class="fc" id="L320">			this.properties.remove(Product.EVENTTIME_PROPERTY);</span>
		}

<span class="fc" id="L323">	}</span>

	/** @return eventLatitude */
	public BigDecimal getEventLatitude() {
<span class="fc" id="L327">		return eventLatitude;</span>
	}

	/** @param eventLatitude to set */
	public void setEventLatitude(BigDecimal eventLatitude) {
<span class="fc" id="L332">		this.eventLatitude = eventLatitude;</span>
<span class="fc bfc" id="L333" title="All 2 branches covered.">		if (eventLatitude != null) {</span>
<span class="fc" id="L334">			this.properties.put(Product.LATITUDE_PROPERTY,</span>
<span class="fc" id="L335">					eventLatitude.toString());</span>
		} else {
<span class="fc" id="L337">			this.properties.remove(Product.LATITUDE_PROPERTY);</span>
		}
<span class="fc" id="L339">	}</span>

	/** @return eventLongitude */
	public BigDecimal getEventLongitude() {
<span class="fc" id="L343">		return eventLongitude;</span>
	}

	/** @param eventLongitude to set */
	public void setEventLongitude(BigDecimal eventLongitude) {
<span class="fc" id="L348">		this.eventLongitude = eventLongitude;</span>
<span class="fc bfc" id="L349" title="All 2 branches covered.">		if (eventLongitude != null) {</span>
<span class="fc" id="L350">			this.properties.put(Product.LONGITUDE_PROPERTY,</span>
<span class="fc" id="L351">					eventLongitude.toString());</span>
		} else {
<span class="fc" id="L353">			this.properties.remove(Product.LONGITUDE_PROPERTY);</span>
		}
<span class="fc" id="L355">	}</span>

	/** @return eventDepth */
	public BigDecimal getEventDepth() {
<span class="fc" id="L359">		return eventDepth;</span>
	}

	/** @param eventDepth to set */
	public void setEventDepth(BigDecimal eventDepth) {
<span class="fc" id="L364">		this.eventDepth = eventDepth;</span>
<span class="fc bfc" id="L365" title="All 2 branches covered.">		if (eventDepth != null) {</span>
<span class="fc" id="L366">			this.properties.put(Product.DEPTH_PROPERTY, eventDepth.toString());</span>
		} else {
<span class="fc" id="L368">			this.properties.remove(Product.DEPTH_PROPERTY);</span>
		}
<span class="fc" id="L370">	}</span>

	/** @return eventMagnitude */
	public BigDecimal getEventMagnitude() {
<span class="fc" id="L374">		return eventMagnitude;</span>
	}

	/** @param eventMagnitude to set */
	public void setEventMagnitude(BigDecimal eventMagnitude) {
<span class="fc" id="L379">		this.eventMagnitude = eventMagnitude;</span>
<span class="fc bfc" id="L380" title="All 2 branches covered.">		if (eventMagnitude != null) {</span>
<span class="fc" id="L381">			this.properties.put(Product.MAGNITUDE_PROPERTY,</span>
<span class="fc" id="L382">					eventMagnitude.toString());</span>
		} else {
<span class="fc" id="L384">			this.properties.remove(Product.MAGNITUDE_PROPERTY);</span>
		}
<span class="fc" id="L386">	}</span>

	/** @return version */
	public String getVersion() {
<span class="fc" id="L390">		return version;</span>
	}

	/** @param version to set */
	public void setVersion(String version) {
<span class="fc" id="L395">		this.version = version;</span>
<span class="fc bfc" id="L396" title="All 2 branches covered.">		if (version != null) {</span>
<span class="fc" id="L397">			this.properties.put(Product.VERSION_PROPERTY, version);</span>
		} else {
<span class="fc" id="L399">			this.properties.remove(Product.VERSION_PROPERTY);</span>
		}
<span class="fc" id="L401">	}</span>

	/** @return type */
	public String getType() {
<span class="fc" id="L405">		return getId().getType();</span>
	}

	/** @return source */
	public String getSource() {
<span class="fc" id="L410">		return getId().getSource();</span>
	}

	/** @return code */
	public String getCode() {
<span class="fc" id="L415">		return getId().getCode();</span>
	}

	/** @return updateTime */
	public Date getUpdateTime() {
<span class="fc" id="L420">		return getId().getUpdateTime();</span>
	}

	/**
	 * Compares two ProductSummaries to determine if they are equal.
	 *
	 * This first implementation just considers the ProductId of each summary.
	 * This is probably not the best way to check for equality.
	 */
	@Override
	public boolean equals(Object o) {
<span class="pc bpc" id="L431" title="1 of 2 branches missed.">		if (o instanceof ProductSummary) {</span>
<span class="fc" id="L432">			return ((ProductSummary) o).getId().equals(this.getId());</span>
		}
<span class="nc" id="L434">		return false;</span>
	}

	/**
	 * Generate hashcode for ProductId using all components.
	 *
	 * This implementation just uses hashcode from ProductId.
	 */
	@Override
	public int hashCode() {
<span class="fc" id="L444">		return getId().hashCode();</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>