<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SearchCLI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pdl</a> &gt; <a href="index.source.html" class="el_package">gov.usgs.earthquake.indexer</a> &gt; <span class="el_source">SearchCLI.java</span></div><h1>SearchCLI.java</h1><pre class="source lang-java linenums">package gov.usgs.earthquake.indexer;

import java.io.FileOutputStream;
import java.io.OutputStream;
import java.math.BigDecimal;
import java.net.InetAddress;
import java.util.logging.Logger;

import gov.usgs.earthquake.product.ProductId;
import gov.usgs.util.XmlUtils;

/**
 * Command line interface for search socket.
 *
 * This class reads arguments from the command line that represent a
 * ProductIndexQuery. Then it connects to a configured socket, executes the
 * search, and outputs the response xml.
 */
public class SearchCLI {

<span class="nc" id="L21">	private static final Logger LOGGER = Logger.getLogger(SearchCLI.class</span>
<span class="nc" id="L22">			.getName());</span>

	/**
	 * Command-line argument definitions
	 */
	/** Argument for search method */
<span class="nc" id="L28">	public static String SEARCH_METHOD_ARGUMENT = &quot;--searchMethod=&quot;;</span>
	/** Argument for result type */
<span class="nc" id="L30">	public static String RESULT_TYPE_ARGUMENT = &quot;--resultType=&quot;;</span>
	/** Argument for event Source */
<span class="nc" id="L32">	public static String EVENT_SOURCE_ARGUMENT = &quot;--eventSource=&quot;;</span>
	/** Argument for event Source Code */
<span class="nc" id="L34">	public static String EVENT_SOURCE_CODE_ARGUMENT = &quot;--eventSourceCode=&quot;;</span>
	/** Argument for minimum Event Time */
<span class="nc" id="L36">	public static String MIN_EVENT_TIME_ARGUMENT = &quot;--minEventTime=&quot;;</span>
	/** Argument for maximum event time */
<span class="nc" id="L38">	public static String MAX_EVENT_TIME_ARGUMENT = &quot;--maxEventTime=&quot;;</span>
	/** Argument for minimum event latitude */
<span class="nc" id="L40">	public static String MIN_EVENT_LATITUDE_ARGUMENT = &quot;--minEventLatitude=&quot;;</span>
	/** Argument for minimum event longitude */
<span class="nc" id="L42">	public static String MIN_EVENT_LONGITUDE_ARGUMENT = &quot;--minEventLongitude=&quot;;</span>
	/** Argument for maximum event latitude */
<span class="nc" id="L44">	public static String MAX_EVENT_LATITUDE_ARGUMENT = &quot;--maxEventLatitude=&quot;;</span>
	/** Argument for maximum event longitude */
<span class="nc" id="L46">	public static String MAX_EVENT_LONGITUDE_ARGUMENT = &quot;--maxEventLongitude=&quot;;</span>
	/** Argument for minimum event depth */
<span class="nc" id="L48">	public static String MIN_EVENT_DEPTH_ARGUMENT = &quot;--minEventDepth=&quot;;</span>
	/** Argument for maximum event depth */
<span class="nc" id="L50">	public static String MAX_EVENT_DEPTH_ARGUMENT = &quot;--maxEventDepth=&quot;;</span>
	/** Argument for minimum event magnitude */
<span class="nc" id="L52">	public static String MIN_EVENT_MAGNITUDE_ARGUMENT = &quot;--minEventMagnitude=&quot;;</span>
	/** Argument for maximum event magnitude */
<span class="nc" id="L54">	public static String MAX_EVENT_MAGNITUDE_ARGUMENT = &quot;--maxEventMagnitude=&quot;;</span>
	/** Argument for product ID */
<span class="nc" id="L56">	public static String PRODUCT_ID_ARGUMENT = &quot;--productId=&quot;;</span>
	/** Argument for  minimum product update time */
<span class="nc" id="L58">	public static String MIN_PRODUCT_UPDATE_TIME_ARGUMENT = &quot;--minProductUpdateTime=&quot;;</span>
	/** Argument for maximum product update time */
<span class="nc" id="L60">	public static String MAX_PRODUCT_UPDATE_TIME_ARGUMENT = &quot;--maxProductUpdateTime=&quot;;</span>
	/** Argument for product source */
<span class="nc" id="L62">	public static String PRODUCT_SOURCE_ARGUMENT = &quot;--productSource=&quot;;</span>
	/** Argument for product type */
<span class="nc" id="L64">	public static String PRODUCT_TYPE_ARGUMENT = &quot;--productType=&quot;;</span>
	/** Argument for product verion */
<span class="nc" id="L66">	public static String PRODUCT_VERSION_ARGUMENT = &quot;--productVersion=&quot;;</span>
	/** Argument for product status */
<span class="nc" id="L68">	public static String PRODUCT_STATUS_ARGUMENT = &quot;--productStatus=&quot;;</span>

	/** Argument for search host */
<span class="nc" id="L71">	public static String SEARCH_HOST_ARGUMENT = &quot;--searchHost=&quot;;</span>
	/** Argument for search port */
<span class="nc" id="L73">	public static String SEARCH_PORT_ARGUMENT = &quot;--searchPort=&quot;;</span>

	/** Argument for file output */
<span class="nc" id="L76">	public static String FILE_OUTPUT_ARGUMENT = &quot;--outputFile=&quot;;</span>

	/**
	 * Default constructor, for configurable interface.
	 */
<span class="nc" id="L81">	public SearchCLI() {</span>
<span class="nc" id="L82">	}</span>

	/**
	 * Entry point into search. Called by Main when the --search argument is
	 * used.
	 *
	 * @param args
	 *            command line arguments.
	 * @throws Exception if error occurs
	 */
	public static void main(final String[] args) throws Exception {
<span class="nc" id="L93">		String outputFilePath = null;</span>
<span class="nc" id="L94">		SearchMethod type = null;</span>
<span class="nc" id="L95">		InetAddress host = InetAddress.getByName(&quot;localhost&quot;);</span>
<span class="nc" id="L96">		int port = Integer.parseInt(SearchServerSocket.DEFAULT_SEARCH_PORT);</span>
<span class="nc" id="L97">		ProductIndexQuery query = new ProductIndexQuery();</span>
		// Alternate result types are currently not supported.
<span class="nc" id="L99">		query.setResultType(ProductIndexQuery.RESULT_TYPE_CURRENT);</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">		for (String arg : args) {</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">			if (arg.startsWith(SEARCH_METHOD_ARGUMENT)) {</span>
<span class="nc" id="L102">				type = SearchMethod.fromXmlMethodName(arg.replace(</span>
						SEARCH_METHOD_ARGUMENT, &quot;&quot;));
<span class="nc bnc" id="L104" title="All 2 branches missed.">				if (type == null) {</span>
<span class="nc" id="L105">					LOGGER.severe(&quot;Undefined search method received: '&quot;</span>
<span class="nc" id="L106">							+ arg.replace(SEARCH_METHOD_ARGUMENT, &quot;&quot;)</span>
							+ &quot;'. Search could not be processed.&quot;);
<span class="nc" id="L108">					throw new Exception();</span>
				}
				/*
				 * Alternate result types are currently not supported. } else if
				 * (arg.startsWith(RESULT_TYPE_ARGUMENT)) { String resultType =
				 * arg.replace(RESULT_TYPE_ARGUMENT, &quot;&quot;); if
				 * (resultType.toLowerCase() == &quot;current&quot;)
				 * query.setResultType(ProductIndexQuery.RESULT_TYPE_CURRENT);
				 * else if (resultType.toLowerCase() == &quot;superseded&quot;)
				 * query.setResultType
				 * (ProductIndexQuery.RESULT_TYPE_SUPERSEDED); else if
				 * (resultType.toLowerCase() == &quot;all&quot;)
				 * query.setResultType(ProductIndexQuery.RESULT_TYPE_ALL);
				 */
<span class="nc bnc" id="L122" title="All 2 branches missed.">			} else if (arg.startsWith(EVENT_SOURCE_ARGUMENT)) {</span>
<span class="nc" id="L123">				query.setEventSource(arg.replace(EVENT_SOURCE_ARGUMENT, &quot;&quot;));</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">			} else if (arg.startsWith(EVENT_SOURCE_CODE_ARGUMENT)) {</span>
<span class="nc" id="L125">				query.setEventSourceCode(arg.replace(</span>
						EVENT_SOURCE_CODE_ARGUMENT, &quot;&quot;));
<span class="nc bnc" id="L127" title="All 2 branches missed.">			} else if (arg.startsWith(MIN_EVENT_TIME_ARGUMENT)) {</span>
<span class="nc" id="L128">				query.setMinEventTime(XmlUtils.getDate(arg.replace(</span>
						MIN_EVENT_TIME_ARGUMENT, &quot;&quot;)));
<span class="nc bnc" id="L130" title="All 2 branches missed.">			} else if (arg.startsWith(MAX_EVENT_TIME_ARGUMENT)) {</span>
<span class="nc" id="L131">				query.setMaxEventTime(XmlUtils.getDate(arg.replace(</span>
						MAX_EVENT_TIME_ARGUMENT, &quot;&quot;)));
<span class="nc bnc" id="L133" title="All 2 branches missed.">			} else if (arg.startsWith(MIN_EVENT_LATITUDE_ARGUMENT)) {</span>
<span class="nc" id="L134">				query.setMinEventLatitude(new BigDecimal(arg.replace(</span>
						MIN_EVENT_LATITUDE_ARGUMENT, &quot;&quot;)));
<span class="nc bnc" id="L136" title="All 2 branches missed.">			} else if (arg.startsWith(MIN_EVENT_LONGITUDE_ARGUMENT)) {</span>
<span class="nc" id="L137">				query.setMinEventLongitude(new BigDecimal(arg.replace(</span>
						MIN_EVENT_LONGITUDE_ARGUMENT, &quot;&quot;)));
<span class="nc bnc" id="L139" title="All 2 branches missed.">			} else if (arg.startsWith(MIN_EVENT_DEPTH_ARGUMENT)) {</span>
<span class="nc" id="L140">				query.setMinEventDepth(new BigDecimal(arg.replace(</span>
						MIN_EVENT_DEPTH_ARGUMENT, &quot;&quot;)));
<span class="nc bnc" id="L142" title="All 2 branches missed.">			} else if (arg.startsWith(MAX_EVENT_LATITUDE_ARGUMENT)) {</span>
<span class="nc" id="L143">				query.setMaxEventLatitude(new BigDecimal(arg.replace(</span>
						MAX_EVENT_LATITUDE_ARGUMENT, &quot;&quot;)));
<span class="nc bnc" id="L145" title="All 2 branches missed.">			} else if (arg.startsWith(MAX_EVENT_LONGITUDE_ARGUMENT)) {</span>
<span class="nc" id="L146">				query.setMaxEventLongitude(new BigDecimal(arg.replace(</span>
						MAX_EVENT_LONGITUDE_ARGUMENT, &quot;&quot;)));
<span class="nc bnc" id="L148" title="All 2 branches missed.">			} else if (arg.startsWith(MAX_EVENT_DEPTH_ARGUMENT)) {</span>
<span class="nc" id="L149">				query.setMaxEventDepth(new BigDecimal(arg.replace(</span>
						MAX_EVENT_DEPTH_ARGUMENT, &quot;&quot;)));
<span class="nc bnc" id="L151" title="All 2 branches missed.">			} else if (arg.startsWith(MIN_EVENT_MAGNITUDE_ARGUMENT)) {</span>
<span class="nc" id="L152">				query.setMinEventMagnitude(new BigDecimal(arg.replace(</span>
						MIN_EVENT_MAGNITUDE_ARGUMENT, &quot;&quot;)));
<span class="nc bnc" id="L154" title="All 2 branches missed.">			} else if (arg.startsWith(MAX_EVENT_MAGNITUDE_ARGUMENT)) {</span>
<span class="nc" id="L155">				query.setMaxEventMagnitude(new BigDecimal(arg.replace(</span>
						MAX_EVENT_MAGNITUDE_ARGUMENT, &quot;&quot;)));
<span class="nc bnc" id="L157" title="All 2 branches missed.">			} else if (arg.startsWith(PRODUCT_ID_ARGUMENT)) {</span>
<span class="nc" id="L158">				query.getProductIds().add(</span>
<span class="nc" id="L159">						ProductId.parse(arg.replace(PRODUCT_ID_ARGUMENT, &quot;&quot;)));</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">			} else if (arg.startsWith(PRODUCT_SOURCE_ARGUMENT)) {</span>
<span class="nc" id="L161">				query.setProductSource(arg.replace(PRODUCT_SOURCE_ARGUMENT, &quot;&quot;));</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">			} else if (arg.startsWith(PRODUCT_STATUS_ARGUMENT)) {</span>
<span class="nc" id="L163">				query.setProductStatus(arg.replace(PRODUCT_STATUS_ARGUMENT, &quot;&quot;));</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">			} else if (arg.startsWith(PRODUCT_TYPE_ARGUMENT)) {</span>
<span class="nc" id="L165">				query.setProductType(arg.replace(PRODUCT_TYPE_ARGUMENT, &quot;&quot;));</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">			} else if (arg.startsWith(PRODUCT_VERSION_ARGUMENT)) {</span>
<span class="nc" id="L167">				query.setProductVersion(arg.replace(PRODUCT_VERSION_ARGUMENT,</span>
						&quot;&quot;));
<span class="nc bnc" id="L169" title="All 2 branches missed.">			} else if (arg.startsWith(SEARCH_HOST_ARGUMENT)) {</span>
<span class="nc" id="L170">				host = InetAddress.getByName(arg.replace(SEARCH_HOST_ARGUMENT,</span>
						&quot;&quot;));
<span class="nc bnc" id="L172" title="All 2 branches missed.">			} else if (arg.startsWith(SEARCH_PORT_ARGUMENT)) {</span>
<span class="nc" id="L173">				port = Integer.parseInt(arg.replace(SEARCH_PORT_ARGUMENT, &quot;&quot;));</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">			} else if (arg.startsWith(FILE_OUTPUT_ARGUMENT)) {</span>
<span class="nc" id="L175">				outputFilePath = arg.replace(FILE_OUTPUT_ARGUMENT, &quot;&quot;);</span>
			}
		}
<span class="nc" id="L178">		SearchRequest request = new SearchRequest();</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">		if (type == null) {</span>
<span class="nc" id="L180">			LOGGER.severe(&quot;No search type was provided.&quot;);</span>
		}
		OutputStream stream;
<span class="nc bnc" id="L183" title="All 2 branches missed.">		if (outputFilePath != null) {</span>
<span class="nc" id="L184">			stream = new FileOutputStream(FILE_OUTPUT_ARGUMENT);</span>
		} else {
<span class="nc" id="L186">			stream = System.out;</span>
		}
<span class="nc" id="L188">		request.addQuery(SearchQuery.getSearchQuery(type, query));</span>

<span class="nc" id="L190">		SearchSocket socket = new SearchSocket(host, port);</span>
<span class="nc" id="L191">		socket.search(request, stream);</span>
<span class="nc" id="L192">	}</span>

	/**
	 * CLI Usage
	 * @return string of usage
	 */
	public static String getUsage() {
<span class="nc" id="L199">		StringBuffer buf = new StringBuffer();</span>

<span class="nc" id="L201">		buf.append(&quot;Product Index Search Interface:\n&quot;);</span>
<span class="nc" id="L202">		buf.append(&quot;--search : Command is using the search interface\n&quot;);</span>
<span class="nc" id="L203">		buf.append(SEARCH_METHOD_ARGUMENT + &quot;METHOD : Any one of &quot;);</span>
<span class="nc" id="L204">		SearchMethod[] methods = SearchMethod.values();</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">		for (int i = 0; i &lt; methods.length; i++) {</span>
<span class="nc" id="L206">			buf.append(&quot;'&quot; + methods[i].getXmlMethodName() + &quot;'&quot;);</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">			if (i &lt; methods.length - 1) {</span>
<span class="nc" id="L208">				buf.append(&quot;, &quot;);</span>
			} else {
<span class="nc" id="L210">				buf.append(&quot;\n&quot;);</span>
			}
		}
<span class="nc" id="L213">		buf.append(&quot;[&quot; + EVENT_SOURCE_ARGUMENT</span>
				+ &quot;SOURCE] : Filter results by event source network.\n&quot;);
<span class="nc" id="L215">		buf.append(&quot;[&quot; + EVENT_SOURCE_CODE_ARGUMENT</span>
				+ &quot;CODE] : Filter results by event source network code.\n&quot;);
<span class="nc" id="L217">		buf.append(&quot;[&quot;</span>
				+ MIN_EVENT_TIME_ARGUMENT
				+ &quot;XML_FORMATTED_TIME] : Filter results by start of time window.\n&quot;);
<span class="nc" id="L220">		buf.append(&quot;[&quot;</span>
				+ MAX_EVENT_TIME_ARGUMENT
				+ &quot;XML_FORMATTED_TIME] : Filter results by end of time window.\n&quot;);
<span class="nc" id="L223">		buf.append(&quot;[&quot; + MIN_EVENT_LATITUDE_ARGUMENT</span>
				+ &quot;LATITUDE] : Filter results by Southern boundary.\n&quot;);
<span class="nc" id="L225">		buf.append(&quot;[&quot; + MAX_EVENT_LATITUDE_ARGUMENT</span>
				+ &quot;LATITUDE] : Filter results by Northern boundary.\n&quot;);
<span class="nc" id="L227">		buf.append(&quot;[&quot; + MIN_EVENT_LONGITUDE_ARGUMENT</span>
				+ &quot;LONGITUDE] : Filter results by Western boundary.\n&quot;);
<span class="nc" id="L229">		buf.append(&quot;[&quot; + MAX_EVENT_LONGITUDE_ARGUMENT</span>
				+ &quot;LONGITUDE] : Filter results by Eastern boundary.\n&quot;);
<span class="nc" id="L231">		buf.append(&quot;[&quot; + MIN_EVENT_DEPTH_ARGUMENT</span>
				+ &quot;DEPTH] : Filter results by minimum depth in km.\n&quot;);
<span class="nc" id="L233">		buf.append(&quot;[&quot; + MAX_EVENT_DEPTH_ARGUMENT</span>
				+ &quot;DEPTH] : Filter results by maximum depth in km.\n&quot;);
<span class="nc" id="L235">		buf.append(&quot;[&quot; + MIN_EVENT_MAGNITUDE_ARGUMENT</span>
				+ &quot;MAGNITUDE] : Filter results by minimum magnitude.\n&quot;);
<span class="nc" id="L237">		buf.append(&quot;[&quot; + MAX_EVENT_MAGNITUDE_ARGUMENT</span>
				+ &quot;MAGNITUDE] : Filter results by maximum magnitude.\n&quot;);
<span class="nc" id="L239">		buf.append(&quot;[&quot;</span>
				+ PRODUCT_ID_ARGUMENT
				+ &quot;PRODUCT_ID] : Filter by product ID. Each time this appears the new ID is added.\n&quot;);
<span class="nc" id="L242">		buf.append(&quot;[&quot; + PRODUCT_SOURCE_ARGUMENT</span>
				+ &quot;SOURCE] : Filter results by product source.\n&quot;);
<span class="nc" id="L244">		buf.append(&quot;[&quot; + PRODUCT_STATUS_ARGUMENT</span>
				+ &quot;STATUS] : Filter results by product status.\n&quot;);
<span class="nc" id="L246">		buf.append(&quot;[&quot; + PRODUCT_TYPE_ARGUMENT</span>
				+ &quot;TYPE] : Filter results by product type.\n&quot;);
<span class="nc" id="L248">		buf.append(&quot;[&quot; + PRODUCT_VERSION_ARGUMENT</span>
				+ &quot;VERSION] : Filter results by product version.\n&quot;);
<span class="nc" id="L250">		buf.append(&quot;[&quot;</span>
				+ SEARCH_HOST_ARGUMENT
				+ &quot;HOST] : The Product Index host to receive this query. Default is localhost.&quot;);
<span class="nc" id="L253">		buf.append(&quot;[&quot;</span>
				+ SEARCH_PORT_ARGUMENT
				+ &quot;PORT] : The port on which to execute this query. Default is &quot;
				+ SearchServerSocket.DEFAULT_SEARCH_PORT + &quot;.\n&quot;);
<span class="nc" id="L257">		buf.append(&quot;[&quot;</span>
				+ FILE_OUTPUT_ARGUMENT
				+ &quot;FILE] : The file to write output to. If this is not included, output will be directed over stdout.&quot;);

<span class="nc" id="L261">		return buf.toString();</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>