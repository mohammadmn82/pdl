<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JsonNotification.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pdl</a> &gt; <a href="index.source.html" class="el_package">gov.usgs.earthquake.aws</a> &gt; <span class="el_source">JsonNotification.java</span></div><h1>JsonNotification.java</h1><pre class="source lang-java linenums">package gov.usgs.earthquake.aws;

import java.net.MalformedURLException;
import java.net.URL;
import java.nio.charset.StandardCharsets;
import java.time.Instant;
import java.util.Base64;
import java.util.Date;

import javax.json.JsonObject;

import gov.usgs.earthquake.distribution.URLNotification;
import gov.usgs.earthquake.product.Product;
import gov.usgs.earthquake.product.io.JsonProduct;
import gov.usgs.util.protocolhandlers.data.Handler;

/**
 * Json formatted notification.
 *
 * Stores stores product content in URLNotification as a data URL.
 */
public class JsonNotification extends URLNotification {

  /** Empty URL for product tracker. */
  public static final URL EMPTY_URL;
  static {
    try {
      // make sure data protocol handler is registered
<span class="fc" id="L29">      Handler.register();</span>
<span class="fc" id="L30">      EMPTY_URL = new URL(&quot;data:,&quot;);</span>
<span class="nc" id="L31">    } catch (MalformedURLException mue) {</span>
<span class="nc" id="L32">      throw new RuntimeException(&quot;failed to parse empty url&quot;);</span>
<span class="fc" id="L33">    }</span>
<span class="fc" id="L34">  }</span>

  /** When notification was created. */
  public final Instant created;
  /** Product attached to notification. */
  public final Product product;

  /**
   * Parse a Json formatted Notification.
   *
   * @param json
   * @throws Exception
   */
  JsonNotification(final JsonObject json) throws Exception {
<span class="fc" id="L48">    this(</span>
<span class="fc" id="L49">        Instant.parse(json.getString(&quot;created&quot;)),</span>
<span class="fc" id="L50">        new JsonProduct().getProduct(json.getJsonObject(&quot;product&quot;)));</span>
<span class="fc" id="L51">  }</span>

  /**
   * Create a JsonNotification from an existing Product.
   */
  JsonNotification(final Instant created, final Product product) throws Exception {
<span class="fc" id="L57">    this(created, product, new Date(Instant.now().plusSeconds(7 * 86400).toEpochMilli()));</span>
<span class="fc" id="L58">  }</span>

  /**
   * Create a JsonNotification with an expiration date.
   */
  JsonNotification(final Instant created, final Product product, final Date expiration)
      throws Exception {
<span class="fc" id="L65">    super(</span>
<span class="fc" id="L66">        product.getId(),</span>
        // expiration date
        expiration,
        // no tracker
        EMPTY_URL,
        // store product as data url
        new URL(&quot;data:;base64,&quot; +
<span class="fc" id="L73">            new String(Base64.getEncoder().encode(</span>
<span class="fc" id="L74">                new JsonProduct().getJsonObject((product))</span>
<span class="fc" id="L75">                    .toString().getBytes(StandardCharsets.UTF_8)))));</span>
<span class="fc" id="L76">    this.created = created;</span>
<span class="fc" id="L77">    this.product = product;</span>
<span class="fc" id="L78">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>