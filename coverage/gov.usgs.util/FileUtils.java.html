<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FileUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pdl</a> &gt; <a href="index.source.html" class="el_package">gov.usgs.util</a> &gt; <span class="el_source">FileUtils.java</span></div><h1>FileUtils.java</h1><pre class="source lang-java linenums">/*
 * FileUtils
 *
 * $Id$
 * $HeadURL$
 */
package gov.usgs.util;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.FileNameMap;
import java.net.URLConnection;
import java.nio.file.AtomicMoveNotSupportedException;
import java.nio.file.Files;
import java.nio.file.StandardCopyOption;

/**
 * File input, output, content type, and delete utilities.
 *
 * @author jmfee
 *
 */
<span class="nc" id="L26">public class FileUtils {</span>

	/** For looking up file mime types. */
<span class="fc" id="L29">	private static final FileNameMap MIMETYPES = URLConnection.getFileNameMap();</span>

	/**
	 * Get a file mime type based on its filename.
	 *
	 * Calls getContentType(file.getName()).
	 *
	 * @param file a file to get type from
	 * @return String mime type.
	 */
	public static String getContentType(final File file) {
<span class="nc" id="L40">		return getContentType(file.getName());</span>
	}

	/**
	 * Get a file mime type based on its file path extension.
	 *
	 * Uses URLConnection.getFileNameMap().
	 *
	 * @param filename
	 *            file path.
	 * @return String mime type.
	 */
	public static String getContentType(final String filename) {
<span class="nc" id="L53">		return MIMETYPES.getContentTypeFor(filename);</span>
	}

	/**
	 * Read file contents into a byte array.
	 *
	 * @param file
	 *            file to read.
	 * @return byte array of file content.
	 * @throws IOException
	 *             if an error occurs while reading.
	 */
	public static byte[] readFile(final File file) throws IOException {
<span class="fc" id="L66">		return StreamUtils.readStream(file);</span>
	}

	/**
	 * Write a file's content.
	 *
	 * @param file
	 *            file to write.
	 * @param content
	 *            content to write to file.
	 * @throws IOException
	 *            if any errors occur
	 */
	public static void writeFile(final File file, final byte[] content)
			throws IOException {
<span class="fc" id="L81">		StreamUtils.transferStream(content, file);</span>
<span class="fc" id="L82">	}</span>

	/**
	 * Write a file's content atomically.
	 *
	 * @param tempfile
	 *            where file is written.
	 * @param file
	 *            where tempfile is moved after writing.
	 * @param content
	 *            file content to write.
	 * @throws IOException
	 *             if any errors occur.
	 */
	public static void writeFileThenMove(final File tempfile, final File file,
			final byte[] content) throws IOException {
<span class="fc" id="L98">		writeFile(tempfile, content);</span>

<span class="fc" id="L100">		File parent = file.getAbsoluteFile().getParentFile();</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">		if (!parent.exists()) {</span>
<span class="fc" id="L102">			parent.mkdirs();</span>
		}
		try {
<span class="fc" id="L105">			Files.move(tempfile.toPath(), file.toPath(), StandardCopyOption.ATOMIC_MOVE);</span>
<span class="nc" id="L106">		} catch (AtomicMoveNotSupportedException amnse) {</span>
<span class="nc" id="L107">			Files.move(tempfile.toPath(), file.toPath(), StandardCopyOption.REPLACE_EXISTING);</span>
<span class="fc" id="L108">		}</span>
<span class="fc" id="L109">	}</span>

	/**
	 * Delete all files recursively within tree.
	 *
	 * @param path
	 *            root of tree to delete.
	 */
	public static void deleteTree(final File path) {
<span class="fc bfc" id="L118" title="All 2 branches covered.">		if (path.exists()) {</span>
<span class="fc bfc" id="L119" title="All 2 branches covered.">			if (path.isDirectory()) {</span>
<span class="fc" id="L120">				File[] files = path.listFiles();</span>
<span class="fc bfc" id="L121" title="All 2 branches covered.">				for (int i = 0; i &lt; files.length; i++) {</span>
<span class="fc bfc" id="L122" title="All 2 branches covered.">					if (files[i].isDirectory()) {</span>
<span class="fc" id="L123">						deleteTree(files[i]);</span>
					} else {
<span class="fc" id="L125">						files[i].delete();</span>
					}
				}
<span class="fc" id="L128">				files = null;</span>
<span class="fc" id="L129">			} else {</span>
<span class="fc" id="L130">				path.delete();</span>
			}
		}

<span class="fc" id="L134">		deleteEmptyParents(path);</span>
<span class="fc" id="L135">	}</span>

	/**
	 * Delete path and any empty parent directories.
	 *
	 * @param path
	 *            directory to start in.
	 */
	public static void deleteEmptyParents(final File path) {
<span class="fc" id="L144">		deleteEmptyParents(path, null);</span>
<span class="fc" id="L145">	}</span>

	/**
	 * Delete path and any empty parent directories up to the stopAt point.
	 *
	 * @param path
	 *            direcotry to start in
	 * @param stopAt
	 *            directory to stop at
	 */
	public static void deleteEmptyParents(final File path, final File stopAt) {
<span class="fc" id="L156">		File parent = path;</span>
		// Loop while parent is not null and we are not yet at the stopAt point
<span class="fc bfc" id="L158" title="All 4 branches covered.">		while (parent != null &amp;&amp; !parent.equals(stopAt)) {</span>
			try {
<span class="fc" id="L160">				parent.delete();</span>
<span class="fc" id="L161">				parent = parent.getParentFile();</span>
<span class="nc" id="L162">			} catch (Exception e) {</span>
<span class="nc" id="L163">				e.printStackTrace();</span>
<span class="nc" id="L164">				break;</span>
<span class="fc" id="L165">			}</span>
		}
<span class="fc" id="L167">	}</span>

	/**
	 * Extracts a resource file from within the executing JAR and copies it to
	 * the file system.
	 *
	 * @param rsFile
	 *            Absolute file path (relative to JAR root) of the file to
	 *            extract.
	 * @param fsFile
	 *            File path where to place the extracted file. An absolute path
	 *            here is relative to the file system root. Relative paths for
	 *            this value are relative to the CWD.
	 */
	public static void extractResourceFile(String rsFile, String fsFile) {
<span class="nc" id="L182">		InputStream is = FileUtils.class.getResourceAsStream(rsFile);</span>
		try {
<span class="nc" id="L184">			FileOutputStream os = new FileOutputStream(fsFile);</span>
			try {
<span class="nc" id="L186">				byte[] buf = new byte[1024];</span>
				while (true) {
<span class="nc" id="L188">					int len = is.read(buf);</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">					if (len &lt; 0) {</span>
<span class="nc" id="L190">						break;</span>
					}
<span class="nc" id="L192">					os.write(buf, 0, len);</span>
<span class="nc" id="L193">				} // END: while</span>

				// Do we have a logger yet?
				// System.err.println(&quot;Copied &quot; + rsFile + &quot; from jar file to &quot; +
				// fsFile+&quot; in the file system.  (&quot;+totalCopied+&quot; bytes).&quot;);
			} finally {
<span class="nc" id="L199">				StreamUtils.closeStream(os);</span>
			}
<span class="nc" id="L201">		} catch (FileNotFoundException fnf) {</span>
			// Logger?
<span class="nc" id="L203">			System.err.println(fnf.getMessage() + &quot; -- 1&quot;);</span>
<span class="nc" id="L204">		} catch (IOException iox) {</span>
			// Logger?
<span class="nc" id="L206">			System.err.println(iox.getMessage() + &quot; -- 2&quot;);</span>
<span class="nc" id="L207">		} catch (NullPointerException npx) {</span>
			// A dummy catch
		} finally {
<span class="nc" id="L210">			StreamUtils.closeStream(is);</span>
		}
<span class="nc" id="L212">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>